\hypertarget{dbcontroller_8c}{}\section{dbcontroller.\+c File Reference}
\label{dbcontroller_8c}\index{dbcontroller.\+c@{dbcontroller.\+c}}
{\ttfamily \#include \char`\"{}dbcontroller.\+h\char`\"{}}\newline
{\ttfamily \#include $<$sqlite3.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{dbcontroller_8c_a836373917e3d6bda1253864bf828aebe}{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+R\+E\+A\+T\+E\+\_\+\+DB}}~\char`\"{}C\+R\+E\+A\+TE T\+A\+B\+LE \%s(U\+S\+E\+R\+ID I\+NT P\+R\+I\+M\+A\+RY K\+EY     N\+OT N\+U\+LL,S\+O\+NG           T\+E\+XT    N\+OT N\+U\+LL);\char`\"{}
\item 
\#define \mbox{\hyperlink{dbcontroller_8c_a9977a338cb4096715d937611fb8f686d}{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+I\+N\+S\+E\+R\+T\+\_\+\+DB}}~\char`\"{}I\+N\+S\+E\+RT I\+N\+TO \%s (U\+S\+E\+R\+ID,S\+O\+NG) V\+A\+L\+U\+ES (\%d,\textquotesingle{}\%s\textquotesingle{}); \char`\"{}
\item 
\#define \mbox{\hyperlink{dbcontroller_8c_a3c0fc6001c2c245be160b4451f821628}{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+H\+E\+C\+K\+\_\+\+DB}}~\char`\"{}S\+E\+L\+E\+CT name F\+R\+OM sqlite\+\_\+master W\+H\+E\+RE type=\textquotesingle{}table\textquotesingle{} A\+ND name=\textquotesingle{}\%s\textquotesingle{};\char`\"{}
\item 
\#define \mbox{\hyperlink{dbcontroller_8c_a14c45fad51df03c9f7ed915b076601dc}{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+DB}}~\char`\"{}S\+E\+L\+E\+CT S\+O\+NG F\+R\+OM \%s W\+H\+E\+RE U\+S\+E\+R\+ID = \%d;\char`\"{}
\item 
\#define \mbox{\hyperlink{dbcontroller_8c_a7876ba4ce4e52f3fed2bb99103797743}{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+G\+E\+T\+\_\+\+N\+U\+M\+B\+E\+R\+\_\+\+O\+F\+\_\+\+E\+L\+E\+M\+E\+N\+TS}}~\char`\"{}S\+E\+L\+E\+CT count($\ast$) F\+R\+OM \%s W\+H\+E\+RE U\+S\+E\+R\+ID = \%d;\char`\"{}
\item 
\#define \mbox{\hyperlink{dbcontroller_8c_a51ad2def95c93dfce02566ae6d54dc65}{S\+Q\+L\+\_\+\+T\+A\+B\+L\+E\+\_\+\+N\+A\+ME}}~\char`\"{}T\+A\+R\+J\+E\+T\+AS\char`\"{}
\item 
\#define \mbox{\hyperlink{dbcontroller_8c_a50d7e91699c53cf3aa53a6161a57d493}{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE}}~500
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{dbcontroller_8c_a0e043d314f2bec3905c664b70cc4d0a1}{db\+\_\+create\+\_\+tables}} (sqlite3 $\ast$db)
\begin{DoxyCompactList}\small\item\em Comprueba si es una base de datos nueva y en caso de serlo crea las tablas necesarias La funcion comprueba si existen la tabla especificada intentando hacer la query de creación, si dicha query se ha ejecutado correctamente, quiere decir que la base de datos es nueva, por lo que se crean las tablas necesarias para adecuarla al modelo de datos. Si la ejecución da error, quiere decir que la base de datos ya existía y no tienen que sobreescribirse las tablas. \end{DoxyCompactList}\item 
sqlite3 $\ast$ \mbox{\hyperlink{dbcontroller_8c_a6c03e23326b03a2084159378345e6fcf}{db\+\_\+load}} (char $\ast$file\+\_\+dir)
\item 
int \mbox{\hyperlink{dbcontroller_8c_a8b76145fe43a8536318fe3494b1d78ee}{db\+\_\+check}} (sqlite3 $\ast$db)
\begin{DoxyCompactList}\small\item\em Ejecuta una query para ver si existe la tabla con el valor especificado. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{dbcontroller_8c_a8954e818fd457eb22674fcf86b086f6a}{db\+\_\+insert}} (sqlite3 $\ast$db, int user\+\_\+id, char $\ast$\mbox{\hyperlink{tipos_8h_aad2bf680e32d8de23ad37cb9980150c0}{song\+\_\+name}})
\begin{DoxyCompactList}\small\item\em Ejecuta la query para insertar en la base de datos. \end{DoxyCompactList}\item 
char $\ast$ \mbox{\hyperlink{dbcontroller_8c_afa05bc6d059b49ba25da7afa536e29a9}{db\+\_\+get\+\_\+song\+\_\+name}} (sqlite3 $\ast$db, int user\+\_\+id)
\begin{DoxyCompactList}\small\item\em Ejecuta la query de busqueda del nombre de la canción dado un ID Hace una query de busqueda del fichero que esta asociado a un ID. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{dbcontroller_8c_a055d575f82c315a645be43d0daa54dbe}{db\+\_\+free\+\_\+song\+\_\+name}} (char $\ast$name)
\begin{DoxyCompactList}\small\item\em Libera memoria del reservado para el nombre de la cancion Binding de la función free. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{dbcontroller_8c_ae07af262c608d2e3de291268d923d24a}{db\+\_\+close}} (sqlite3 $\ast$db)
\begin{DoxyCompactList}\small\item\em Cierra la base de datos y libera la memoria asignada al puntero. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{dbcontroller_8c_a3c0fc6001c2c245be160b4451f821628}\label{dbcontroller_8c_a3c0fc6001c2c245be160b4451f821628}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+H\+E\+C\+K\+\_\+\+DB@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+H\+E\+C\+K\+\_\+\+DB}}
\index{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+H\+E\+C\+K\+\_\+\+DB@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+H\+E\+C\+K\+\_\+\+DB}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+H\+E\+C\+K\+\_\+\+DB}{SQL\_QUERY\_CHECK\_DB}}
{\footnotesize\ttfamily \#define S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+H\+E\+C\+K\+\_\+\+DB~\char`\"{}S\+E\+L\+E\+CT name F\+R\+OM sqlite\+\_\+master W\+H\+E\+RE type=\textquotesingle{}table\textquotesingle{} A\+ND name=\textquotesingle{}\%s\textquotesingle{};\char`\"{}}



Definition at line 19 of file dbcontroller.\+c.

\mbox{\Hypertarget{dbcontroller_8c_a836373917e3d6bda1253864bf828aebe}\label{dbcontroller_8c_a836373917e3d6bda1253864bf828aebe}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+R\+E\+A\+T\+E\+\_\+\+DB@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+R\+E\+A\+T\+E\+\_\+\+DB}}
\index{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+R\+E\+A\+T\+E\+\_\+\+DB@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+R\+E\+A\+T\+E\+\_\+\+DB}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+R\+E\+A\+T\+E\+\_\+\+DB}{SQL\_QUERY\_CREATE\_DB}}
{\footnotesize\ttfamily \#define S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+C\+R\+E\+A\+T\+E\+\_\+\+DB~\char`\"{}C\+R\+E\+A\+TE T\+A\+B\+LE \%s(U\+S\+E\+R\+ID I\+NT P\+R\+I\+M\+A\+RY K\+EY     N\+OT N\+U\+LL,S\+O\+NG           T\+E\+XT    N\+OT N\+U\+LL);\char`\"{}}



Definition at line 17 of file dbcontroller.\+c.

\mbox{\Hypertarget{dbcontroller_8c_a7876ba4ce4e52f3fed2bb99103797743}\label{dbcontroller_8c_a7876ba4ce4e52f3fed2bb99103797743}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+G\+E\+T\+\_\+\+N\+U\+M\+B\+E\+R\+\_\+\+O\+F\+\_\+\+E\+L\+E\+M\+E\+N\+TS@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+G\+E\+T\+\_\+\+N\+U\+M\+B\+E\+R\+\_\+\+O\+F\+\_\+\+E\+L\+E\+M\+E\+N\+TS}}
\index{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+G\+E\+T\+\_\+\+N\+U\+M\+B\+E\+R\+\_\+\+O\+F\+\_\+\+E\+L\+E\+M\+E\+N\+TS@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+G\+E\+T\+\_\+\+N\+U\+M\+B\+E\+R\+\_\+\+O\+F\+\_\+\+E\+L\+E\+M\+E\+N\+TS}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+G\+E\+T\+\_\+\+N\+U\+M\+B\+E\+R\+\_\+\+O\+F\+\_\+\+E\+L\+E\+M\+E\+N\+TS}{SQL\_QUERY\_GET\_NUMBER\_OF\_ELEMENTS}}
{\footnotesize\ttfamily \#define S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+G\+E\+T\+\_\+\+N\+U\+M\+B\+E\+R\+\_\+\+O\+F\+\_\+\+E\+L\+E\+M\+E\+N\+TS~\char`\"{}S\+E\+L\+E\+CT count($\ast$) F\+R\+OM \%s W\+H\+E\+RE U\+S\+E\+R\+ID = \%d;\char`\"{}}



Definition at line 21 of file dbcontroller.\+c.

\mbox{\Hypertarget{dbcontroller_8c_a9977a338cb4096715d937611fb8f686d}\label{dbcontroller_8c_a9977a338cb4096715d937611fb8f686d}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+I\+N\+S\+E\+R\+T\+\_\+\+DB@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+I\+N\+S\+E\+R\+T\+\_\+\+DB}}
\index{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+I\+N\+S\+E\+R\+T\+\_\+\+DB@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+I\+N\+S\+E\+R\+T\+\_\+\+DB}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+I\+N\+S\+E\+R\+T\+\_\+\+DB}{SQL\_QUERY\_INSERT\_DB}}
{\footnotesize\ttfamily \#define S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+I\+N\+S\+E\+R\+T\+\_\+\+DB~\char`\"{}I\+N\+S\+E\+RT I\+N\+TO \%s (U\+S\+E\+R\+ID,S\+O\+NG) V\+A\+L\+U\+ES (\%d,\textquotesingle{}\%s\textquotesingle{}); \char`\"{}}



Definition at line 18 of file dbcontroller.\+c.

\mbox{\Hypertarget{dbcontroller_8c_a50d7e91699c53cf3aa53a6161a57d493}\label{dbcontroller_8c_a50d7e91699c53cf3aa53a6161a57d493}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE}}
\index{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE}{SQL\_QUERY\_MAX\_SIZE}}
{\footnotesize\ttfamily \#define S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+M\+A\+X\+\_\+\+S\+I\+ZE~500}



Definition at line 25 of file dbcontroller.\+c.

\mbox{\Hypertarget{dbcontroller_8c_a14c45fad51df03c9f7ed915b076601dc}\label{dbcontroller_8c_a14c45fad51df03c9f7ed915b076601dc}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+DB@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+DB}}
\index{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+DB@{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+DB}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+DB}{SQL\_QUERY\_SELECT\_DB}}
{\footnotesize\ttfamily \#define S\+Q\+L\+\_\+\+Q\+U\+E\+R\+Y\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+DB~\char`\"{}S\+E\+L\+E\+CT S\+O\+NG F\+R\+OM \%s W\+H\+E\+RE U\+S\+E\+R\+ID = \%d;\char`\"{}}



Definition at line 20 of file dbcontroller.\+c.

\mbox{\Hypertarget{dbcontroller_8c_a51ad2def95c93dfce02566ae6d54dc65}\label{dbcontroller_8c_a51ad2def95c93dfce02566ae6d54dc65}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!S\+Q\+L\+\_\+\+T\+A\+B\+L\+E\+\_\+\+N\+A\+ME@{S\+Q\+L\+\_\+\+T\+A\+B\+L\+E\+\_\+\+N\+A\+ME}}
\index{S\+Q\+L\+\_\+\+T\+A\+B\+L\+E\+\_\+\+N\+A\+ME@{S\+Q\+L\+\_\+\+T\+A\+B\+L\+E\+\_\+\+N\+A\+ME}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{S\+Q\+L\+\_\+\+T\+A\+B\+L\+E\+\_\+\+N\+A\+ME}{SQL\_TABLE\_NAME}}
{\footnotesize\ttfamily \#define S\+Q\+L\+\_\+\+T\+A\+B\+L\+E\+\_\+\+N\+A\+ME~\char`\"{}T\+A\+R\+J\+E\+T\+AS\char`\"{}}



Definition at line 23 of file dbcontroller.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{dbcontroller_8c_a8b76145fe43a8536318fe3494b1d78ee}\label{dbcontroller_8c_a8b76145fe43a8536318fe3494b1d78ee}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!db\+\_\+check@{db\+\_\+check}}
\index{db\+\_\+check@{db\+\_\+check}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{db\+\_\+check()}{db\_check()}}
{\footnotesize\ttfamily int db\+\_\+check (\begin{DoxyParamCaption}\item[{sqlite3 $\ast$}]{db }\end{DoxyParamCaption})}



Ejecuta una query para ver si existe la tabla con el valor especificado. 


\begin{DoxyParams}{Parameters}
{\em db} & Sqlite3 puntero de la estructura cargada \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int controll code 
\end{DoxyReturn}


Definition at line 63 of file dbcontroller.\+c.


\begin{DoxyCode}
63                          \{
64     \textcolor{keywordtype}{int} rc;
65     \textcolor{keywordtype}{char}* sql = (\textcolor{keywordtype}{char}*)malloc(\mbox{\hyperlink{dbcontroller_8c_a50d7e91699c53cf3aa53a6161a57d493}{SQL\_QUERY\_MAX\_SIZE}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));
66     \textcolor{keywordtype}{char}* zErrMsg = 0;
67     \textcolor{keyword}{const} \textcolor{keywordtype}{char}* data = \textcolor{stringliteral}{"Callback function called"};
68     sprintf(sql,\mbox{\hyperlink{dbcontroller_8c_a3c0fc6001c2c245be160b4451f821628}{SQL\_QUERY\_CHECK\_DB}},\mbox{\hyperlink{dbcontroller_8c_a51ad2def95c93dfce02566ae6d54dc65}{SQL\_TABLE\_NAME}});
69 
70     rc = sqlite3\_exec(db, sql, \mbox{\hyperlink{pi_music_box__2_8c_a5559b6f8334054ad27750eb1b4dee6ce}{callback}}, (\textcolor{keywordtype}{void}*) data, &zErrMsg);
71     \textcolor{keywordflow}{if} (rc != SQLITE\_OK) \{
72         fprintf(stderr, \textcolor{stringliteral}{"Error query busqueda tablas: %s"}, zErrMsg);
73         sqlite3\_free(zErrMsg);
74         \textcolor{keywordflow}{return} \mbox{\hyperlink{dbcontroller_8h_a90971f93a64656d6b2a9fc4006d00fbeae580ff302465f1a990d401d94cfbeff1}{SQL\_OPERATION\_ERR}};
75     \} \textcolor{keywordflow}{else} \{
76         fprintf(stdout, \textcolor{stringliteral}{"Todo correcto buscando tablas\(\backslash\)n"});
77     \}
78     free(sql);
79     \textcolor{keywordflow}{return} \mbox{\hyperlink{dbcontroller_8h_a90971f93a64656d6b2a9fc4006d00fbeaf0913fa0529636ee554e74e2609eaa9f}{SQL\_OPERATION\_OK}};
80 \}
\end{DoxyCode}
\mbox{\Hypertarget{dbcontroller_8c_ae07af262c608d2e3de291268d923d24a}\label{dbcontroller_8c_ae07af262c608d2e3de291268d923d24a}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!db\+\_\+close@{db\+\_\+close}}
\index{db\+\_\+close@{db\+\_\+close}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{db\+\_\+close()}{db\_close()}}
{\footnotesize\ttfamily void db\+\_\+close (\begin{DoxyParamCaption}\item[{sqlite3 $\ast$}]{db }\end{DoxyParamCaption})}



Cierra la base de datos y libera la memoria asignada al puntero. 


\begin{DoxyParams}{Parameters}
{\em db} & \\
\hline
\end{DoxyParams}


Definition at line 203 of file dbcontroller.\+c.


\begin{DoxyCode}
203                           \{
204     sqlite3\_close(db);
205 \}
\end{DoxyCode}
\mbox{\Hypertarget{dbcontroller_8c_a0e043d314f2bec3905c664b70cc4d0a1}\label{dbcontroller_8c_a0e043d314f2bec3905c664b70cc4d0a1}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!db\+\_\+create\+\_\+tables@{db\+\_\+create\+\_\+tables}}
\index{db\+\_\+create\+\_\+tables@{db\+\_\+create\+\_\+tables}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{db\+\_\+create\+\_\+tables()}{db\_create\_tables()}}
{\footnotesize\ttfamily void db\+\_\+create\+\_\+tables (\begin{DoxyParamCaption}\item[{sqlite3 $\ast$}]{db }\end{DoxyParamCaption})}



Comprueba si es una base de datos nueva y en caso de serlo crea las tablas necesarias La funcion comprueba si existen la tabla especificada intentando hacer la query de creación, si dicha query se ha ejecutado correctamente, quiere decir que la base de datos es nueva, por lo que se crean las tablas necesarias para adecuarla al modelo de datos. Si la ejecución da error, quiere decir que la base de datos ya existía y no tienen que sobreescribirse las tablas. 


\begin{DoxyParams}{Parameters}
{\em db} & Sqlite3 puntero de la estructura cargada \\
\hline
\end{DoxyParams}


Definition at line 94 of file dbcontroller.\+c.


\begin{DoxyCode}
94                                   \{
95     \textcolor{keywordtype}{int} rc;
96     \textcolor{keywordtype}{char}* sql = (\textcolor{keywordtype}{char}*)malloc(\mbox{\hyperlink{dbcontroller_8c_a50d7e91699c53cf3aa53a6161a57d493}{SQL\_QUERY\_MAX\_SIZE}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));
97     \textcolor{keywordtype}{char}* zErrMsg = 0;
98     \textcolor{comment}{//Formateamos la query con sprintf para permitir genericos}
99     sprintf(sql,\mbox{\hyperlink{dbcontroller_8c_a836373917e3d6bda1253864bf828aebe}{SQL\_QUERY\_CREATE\_DB}},\mbox{\hyperlink{dbcontroller_8c_a51ad2def95c93dfce02566ae6d54dc65}{SQL\_TABLE\_NAME}});
100     \textcolor{comment}{/*}
101 \textcolor{comment}{     * Si la query me da error, es porque esa tabla ya existe,}
102 \textcolor{comment}{     * por lo que la creacion se ignora y no afecta a los datos}
103 \textcolor{comment}{     * */}
104     rc = sqlite3\_exec(db, sql, NULL, 0, &zErrMsg);
105     \textcolor{keywordflow}{if} (rc != SQLITE\_OK) \{
106         \textcolor{comment}{//Si tengo error, la base ya tiene la tabla}
107         fprintf(stderr, \textcolor{stringliteral}{"Base de datos con datos, no creo tablas\(\backslash\)n Por si acaso printeo el error %s \(\backslash\)n"}, 
      zErrMsg);
108         \textcolor{comment}{//Libero memoria del error}
109         sqlite3\_free(zErrMsg);
110     \} \textcolor{keywordflow}{else} \{
111         \textcolor{comment}{/* Si no tengo error al inicializar la base de datos}
112 \textcolor{comment}{         * he creado una nueva, por lo que debo formatear las tablas}
113 \textcolor{comment}{         * acorde a lo esperado por la tarjeta}
114 \textcolor{comment}{         */}
115         fprintf(stdout, \textcolor{stringliteral}{"Base de datos nueva, creo las tablas\(\backslash\)n"});
116     \}
117     \textcolor{comment}{//Libero memoria de la query}
118     free(sql);
119 \}
\end{DoxyCode}
\mbox{\Hypertarget{dbcontroller_8c_a055d575f82c315a645be43d0daa54dbe}\label{dbcontroller_8c_a055d575f82c315a645be43d0daa54dbe}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!db\+\_\+free\+\_\+song\+\_\+name@{db\+\_\+free\+\_\+song\+\_\+name}}
\index{db\+\_\+free\+\_\+song\+\_\+name@{db\+\_\+free\+\_\+song\+\_\+name}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{db\+\_\+free\+\_\+song\+\_\+name()}{db\_free\_song\_name()}}
{\footnotesize\ttfamily void db\+\_\+free\+\_\+song\+\_\+name (\begin{DoxyParamCaption}\item[{char $\ast$}]{name }\end{DoxyParamCaption})}



Libera memoria del reservado para el nombre de la cancion Binding de la función free. 


\begin{DoxyParams}{Parameters}
{\em name} & string del que se quiere liberar memoria \\
\hline
\end{DoxyParams}


Definition at line 195 of file dbcontroller.\+c.


\begin{DoxyCode}
195                                   \{
196     free(name);
197 \}
\end{DoxyCode}
\mbox{\Hypertarget{dbcontroller_8c_afa05bc6d059b49ba25da7afa536e29a9}\label{dbcontroller_8c_afa05bc6d059b49ba25da7afa536e29a9}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!db\+\_\+get\+\_\+song\+\_\+name@{db\+\_\+get\+\_\+song\+\_\+name}}
\index{db\+\_\+get\+\_\+song\+\_\+name@{db\+\_\+get\+\_\+song\+\_\+name}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{db\+\_\+get\+\_\+song\+\_\+name()}{db\_get\_song\_name()}}
{\footnotesize\ttfamily char$\ast$ db\+\_\+get\+\_\+song\+\_\+name (\begin{DoxyParamCaption}\item[{sqlite3 $\ast$}]{db,  }\item[{int}]{user\+\_\+id }\end{DoxyParamCaption})}



Ejecuta la query de busqueda del nombre de la canción dado un ID Hace una query de busqueda del fichero que esta asociado a un ID. 


\begin{DoxyParams}{Parameters}
{\em db} & Sqlite3 puntero de la estructura cargada \\
\hline
{\em user\+\_\+id} & Id de la tarjeta \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
char$\ast$ nombre de la canción, N\+U\+LL 
\end{DoxyReturn}


Definition at line 157 of file dbcontroller.\+c.


\begin{DoxyCode}
157                                                \{
158     \textcolor{keywordtype}{char} *zErrMsg = 0;
159     \textcolor{keywordtype}{int} rc;
160     \textcolor{keywordtype}{char}* sql = (\textcolor{keywordtype}{char}*) malloc(\mbox{\hyperlink{dbcontroller_8c_a50d7e91699c53cf3aa53a6161a57d493}{SQL\_QUERY\_MAX\_SIZE}} * \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));
161     \textcolor{keywordtype}{char}* name = (\textcolor{keywordtype}{char}*)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char})*200);
162     sprintf(sql,\mbox{\hyperlink{dbcontroller_8c_a7876ba4ce4e52f3fed2bb99103797743}{SQL\_QUERY\_GET\_NUMBER\_OF\_ELEMENTS}},
      \mbox{\hyperlink{dbcontroller_8c_a51ad2def95c93dfce02566ae6d54dc65}{SQL\_TABLE\_NAME}},user\_id);
163     printf(\textcolor{stringliteral}{"%s"},sql);
164     rc = sqlite3\_exec(db, sql, db\_callback\_get\_num\_of\_elm, name, &zErrMsg);
165     \textcolor{keywordflow}{if} (rc != SQLITE\_OK) \{
166         fprintf(stderr, \textcolor{stringliteral}{"SQL error: %s\(\backslash\)n"}, zErrMsg);
167         sqlite3\_free(zErrMsg);
168         free(sql);
169         \textcolor{keywordflow}{return} NULL;
170     \}
171     fprintf(stdout, \textcolor{stringliteral}{"Lectura correcta de la base de datos\(\backslash\)n"});
172     \textcolor{keywordflow}{if}(*(name) == 0x30)\{
173         \mbox{\hyperlink{dbcontroller_8c_a055d575f82c315a645be43d0daa54dbe}{db\_free\_song\_name}}(name);
174         \textcolor{keywordflow}{return} NULL;
175     \}
176     sprintf(sql,\mbox{\hyperlink{dbcontroller_8c_a14c45fad51df03c9f7ed915b076601dc}{SQL\_QUERY\_SELECT\_DB}},\mbox{\hyperlink{dbcontroller_8c_a51ad2def95c93dfce02566ae6d54dc65}{SQL\_TABLE\_NAME}},user\_id);
177     rc = sqlite3\_exec(db, sql, db\_callback\_get\_song\_name, name, &zErrMsg);
178     \textcolor{keywordflow}{if} (rc != SQLITE\_OK) \{
179         fprintf(stderr, \textcolor{stringliteral}{"SQL error: %s\(\backslash\)n"}, zErrMsg);
180         sqlite3\_free(zErrMsg);
181         free(sql);
182         \textcolor{keywordflow}{return} NULL;
183     \}
184     fprintf(stdout, \textcolor{stringliteral}{"Lectura correcta de la base de datos\(\backslash\)n"});
185     free(sql);
186     \textcolor{keywordflow}{return} name;
187 \}
\end{DoxyCode}
\mbox{\Hypertarget{dbcontroller_8c_a8954e818fd457eb22674fcf86b086f6a}\label{dbcontroller_8c_a8954e818fd457eb22674fcf86b086f6a}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!db\+\_\+insert@{db\+\_\+insert}}
\index{db\+\_\+insert@{db\+\_\+insert}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{db\+\_\+insert()}{db\_insert()}}
{\footnotesize\ttfamily int db\+\_\+insert (\begin{DoxyParamCaption}\item[{sqlite3 $\ast$}]{db,  }\item[{int}]{user\+\_\+id,  }\item[{char $\ast$}]{song\+\_\+name }\end{DoxyParamCaption})}



Ejecuta la query para insertar en la base de datos. 


\begin{DoxyParams}{Parameters}
{\em db} & Sqlite3 puntero de la estructura cargada \\
\hline
{\em user\+\_\+id} & Id que se quiere almacenar \\
\hline
{\em song\+\_\+name} & Nombre del fichero asociado al ID \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int Codigo de control 
\end{DoxyReturn}


Definition at line 129 of file dbcontroller.\+c.


\begin{DoxyCode}
129                                                       \{
130     \textcolor{keywordtype}{char} *zErrMsg = 0;
131     \textcolor{keywordtype}{int} rc;
132     \textcolor{keywordtype}{char}* sql = (\textcolor{keywordtype}{char}*) malloc(\mbox{\hyperlink{dbcontroller_8c_a50d7e91699c53cf3aa53a6161a57d493}{SQL\_QUERY\_MAX\_SIZE}} * \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));
133 
134     sprintf(sql,\mbox{\hyperlink{dbcontroller_8c_a9977a338cb4096715d937611fb8f686d}{SQL\_QUERY\_INSERT\_DB}},\mbox{\hyperlink{dbcontroller_8c_a51ad2def95c93dfce02566ae6d54dc65}{SQL\_TABLE\_NAME}},user\_id,
      \mbox{\hyperlink{tipos_8h_aad2bf680e32d8de23ad37cb9980150c0}{song\_name}});
135 
136     rc = sqlite3\_exec(db, sql, NULL, 0, &zErrMsg);
137     \textcolor{keywordflow}{if} (rc != SQLITE\_OK) \{
138         fprintf(stderr, \textcolor{stringliteral}{"SQL error: %s\(\backslash\)n"}, zErrMsg);
139         sqlite3\_free(zErrMsg);
140         free(sql);
141         \textcolor{keywordflow}{return} \mbox{\hyperlink{dbcontroller_8h_a90971f93a64656d6b2a9fc4006d00fbeae580ff302465f1a990d401d94cfbeff1}{SQL\_OPERATION\_ERR}};
142     \} \textcolor{keywordflow}{else} \{
143         fprintf(stdout, \textcolor{stringliteral}{"Escritura correcta en la base de datos\(\backslash\)n"});
144     \}
145     free(sql);
146     \textcolor{keywordflow}{return} \mbox{\hyperlink{dbcontroller_8h_a90971f93a64656d6b2a9fc4006d00fbeaf0913fa0529636ee554e74e2609eaa9f}{SQL\_OPERATION\_OK}};
147 \}
\end{DoxyCode}
\mbox{\Hypertarget{dbcontroller_8c_a6c03e23326b03a2084159378345e6fcf}\label{dbcontroller_8c_a6c03e23326b03a2084159378345e6fcf}} 
\index{dbcontroller.\+c@{dbcontroller.\+c}!db\+\_\+load@{db\+\_\+load}}
\index{db\+\_\+load@{db\+\_\+load}!dbcontroller.\+c@{dbcontroller.\+c}}
\subsubsection{\texorpdfstring{db\+\_\+load()}{db\_load()}}
{\footnotesize\ttfamily sqlite3$\ast$ db\+\_\+load (\begin{DoxyParamCaption}\item[{char $\ast$}]{file\+\_\+dir }\end{DoxyParamCaption})}



Definition at line 42 of file dbcontroller.\+c.


\begin{DoxyCode}
42                                 \{
43     sqlite3* db;
44     \textcolor{keywordtype}{int} rc;
45     \textcolor{keywordflow}{if}((rc = sqlite3\_open(file\_dir,&db)))\{
46         fprintf(stderr,\textcolor{stringliteral}{"No se puede abrir la base de datos %s \(\backslash\)n"},sqlite3\_errmsg(db));
47         \textcolor{keywordflow}{return} NULL;
48     \}
49     fprintf(stdout,\textcolor{stringliteral}{"Base de datos abierta \(\backslash\)n"});
50     \textcolor{comment}{/*Funcion de persistencia para que siempre que haya una base de datos}
51 \textcolor{comment}{     * se compruebe que sea correcta}
52 \textcolor{comment}{     * */}
53     \mbox{\hyperlink{dbcontroller_8c_a0e043d314f2bec3905c664b70cc4d0a1}{db\_create\_tables}}(db);
54     \textcolor{keywordflow}{return} db;
55 \}
\end{DoxyCode}
